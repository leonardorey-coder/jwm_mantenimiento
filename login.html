<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - JW Marriott Sistema de Mantenimiento</title>
    
    <!-- Establecer tema antes de cargar estilos -->
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/login-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="login-body">
    <div class="login-container">
        <!-- Logo Container con animaci√≥n -->
        <div class="login-logo-container">
            <img src="logo_high.png" alt="JW Marriott Logo" class="login-logo">
            <h1 class="login-title">JW Marriott</h1>
            <p class="login-subtitle">Sistema de Gesti√≥n de Servicios, de Mantenimiento, Habitaciones y Espacios Comunes</p>
        </div>

        <!-- Switch de Tema en el login -->
        <div class="theme-toggle-login">
            <button id="themeToggleLogin" class="theme-toggle-btn">
                <i class="fas fa-moon"></i>
            </button>
        </div>

        <!-- Toggle: Iniciar Sesi√≥n / Registrarse -->
        <div class="login-toggle">
            <button class="toggle-button active" data-mode="login">
                Iniciar Sesi√≥n
            </button>
            <button class="toggle-button" data-mode="register">
                Registrarse
            </button>
        </div>

        <!-- Formulario de Login -->
        <form id="loginForm" class="auth-form active">
            <div class="form-group">
                <label for="loginEmail">
                    <i class="fas fa-envelope"></i>
                    Correo Electr√≥nico
                </label>
                <input 
                    type="email" 
                    id="loginEmail" 
                    class="form-input" 
                    placeholder="correo@ejemplo.com" 
                    required
                >
            </div>

            <div class="form-group">
                <label for="loginPassword">
                    <i class="fas fa-lock"></i>
                    Contrase√±a
                </label>
                <div class="password-input-container">
                    <input 
                        type="password" 
                        id="loginPassword" 
                        class="form-input" 
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                        required
                    >
                    <button type="button" class="toggle-password" data-target="loginPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="form-options">
                <label class="remember-me">
                    <input type="checkbox" id="rememberMe">
                    <span>Recordarme</span>
                </label>
                <a href="#" class="forgot-password">¬øOlvidaste tu contrase√±a?</a>
            </div>

            <button type="submit" class="btn-submit">
                <i class="fas fa-sign-in-alt"></i>
                Iniciar Sesi√≥n
            </button>
        </form>

        <!-- Formulario de Registro (Deshabilitado - Contactar Administrador) -->
        <div id="registerForm" class="auth-form register-disabled">
            <div class="register-message-container">
                <div class="register-icon">
                    <i class="fas fa-user-shield"></i>
                </div>
                <h3 class="register-message-title">Registro Restringido</h3>
                <p class="register-message-text">
                    El registro de nuevos usuarios est√° restringido por seguridad.
                </p>
                <p class="register-message-contact">
                    Para solicitar acceso al sistema, por favor contacta al administrador:
                </p>
                <a href="mailto:fcruz@grupodiestra.com" class="register-admin-email">
                    <i class="fas fa-envelope"></i>
                    fcruz@grupodiestra.com
                </a>
                <div class="register-info">
                    <i class="fas fa-info-circle"></i>
                    <span>El administrador verificar√° tu identidad y asignar√° los permisos correspondientes.</span>
                </div>
            </div>
        </div>

        <!-- Mensaje de error/√©xito -->
        <div id="authMessage" class="auth-message"></div>

        <!-- Modal cambio obligatorio de contrase√±a -->
        <div class="force-password-modal" id="forcePasswordModal">
            <div class="force-password-card">
                <div class="force-password-header">
                    <i class="fas fa-shield-alt"></i>
                    <div>
                        <h3>Actualiza tu contrase√±a</h3>
                        <p>Por seguridad, <span id="forcePasswordUser">tu cuenta</span> debe establecer una nueva contrase√±a antes de continuar.</p>
                    </div>
                </div>
                <form id="forcePasswordForm" class="force-password-form" novalidate>
                    <label>
                        <span>Contrase√±a actual</span>
                        <input type="password" id="forceCurrentPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </label>
                    <label>
                        <span>Nueva contrase√±a</span>
                        <input type="password" id="forceNewPassword" placeholder="M√≠nimo 8 caracteres" required>
                    </label>
                    <label>
                        <span>Confirmar nueva contrase√±a</span>
                        <input type="password" id="forceConfirmPassword" placeholder="Repite la contrase√±a" required>
                    </label>
                    <div class="force-password-feedback" id="forcePasswordFeedback"></div>
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-key"></i>
                        Cambiar contrase√±a y continuar
                    </button>
                </form>
            </div>
        </div>

        <!-- Footer -->
        <div class="login-footer">
            <p>&copy; 2025 JW Marriott Los Cabos. Todos los derechos reservados.</p>
        </div>
    </div>

    <!-- IndexedDB Manager - Sistema de almacenamiento local -->
    <script type="module">
        // Importar m√≥dulos de IndexedDB
        import dbManager from './js/indexeddb-manager.js';
        import storageHelper from './js/storage-helper.js';
        
        // Exponer globalmente para compatibilidad
        window.dbManager = dbManager;
        window.storageHelper = storageHelper;
        
        // Inicializar IndexedDB antes de cargar login
        console.log('üîß [Login] Inicializando sistema de almacenamiento...');
        
        Promise.all([
            dbManager.init(),
            storageHelper.init()
        ]).then(() => {
            console.log('‚úÖ [Login] Sistema de almacenamiento inicializado');
            
            // Cargar script de login
            const script = document.createElement('script');
            script.src = 'js/login-jwt.js?v=' + Date.now();
            script.onload = () => console.log('‚úÖ [Login] Script de login cargado');
            script.onerror = (error) => console.error('‚ùå [Login] Error cargando script:', error);
            document.body.appendChild(script);
        }).catch(error => {
            console.error('‚ùå [Login] Error al inicializar storage:', error);
            
            // Cargar de todas formas (fallback)
            const script = document.createElement('script');
            script.src = 'js/login-jwt.js?v=' + Date.now();
            script.onload = () => console.log('‚úÖ [Login] Script cargado en modo fallback');
            document.body.appendChild(script);
        });
    </script>
</body>
</html>

